<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Client - Nett'Ovation</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
        input, textarea, select, button { width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .avis-item { background-color: #f9f9f9; padding: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Page Client - <span id="clientName"></span></h1>
    
    <div class="section" id="clientInfo">
        <h2>Informations du client</h2>
        <!-- Les informations du client seront insérées ici -->
    </div>

    <div class="section">
        <h2>Ajouter un avis de passage</h2>
        <form id="avisForm">
            <input type="date" id="date" required>
            <input type="time" id="heureDebut" required>
            <input type="time" id="heureFin" required>
            <textarea id="observations" placeholder="Observations" required></textarea>
            <input type="text" id="intervenant" placeholder="Nom de l'intervenant" required>
            <select id="typeIntervention" required>
                <option value="prochaine">Prochaine intervention</option>
                <option value="aPrevoir">À prévoir</option>
            </select>
            <input type="datetime-local" id="dateIntervention">
            <button type="submit">Ajouter l'avis</button>
        </form>
    </div>

    <div class="section">
        <h2>Historique des avis</h2>
        <div id="avisList"></div>
    </div>

    <script>
        let clientId;

        function loadClientInfo() {
            const urlParams = new URLSearchParams(window.location.search);
            clientId = urlParams.get('id');
            const clients = JSON.parse(localStorage.getItem('clients')) || [];
            const client = clients.find(c => c.id === clientId);
            if (client) {
                document.getElementById('clientName').textContent = client.nomPrenom;
                document.getElementById('clientInfo').innerHTML += `
                    <p>Société : ${client.societe || 'N/A'}</p>
                    <p>Adresse : ${client.adresse}</p>
                    <p>Téléphone : ${client.numero}</p>
                    <p>Email : ${client.email}</p>
                `;
            } else {
                alert('Client non trouvé');
            }
        }

        function saveAvis(e) {
            e.preventDefault();
            const avis = {
                date: document.getElementById('date').value,
                heureDebut: document.getElementById('heureDebut').value,
                heureFin: document.getElementById('heureFin').value,
                observations: document.getElementById('observations').value,
                intervenant: document.getElementById('intervenant').value,
                typeIntervention: document.getElementById('typeIntervention').value,
                dateIntervention: document.getElementById('dateIntervention').value
            };
            let avisClient = JSON.parse(localStorage.getItem(`avis_${clientId}`)) || [];
            avisClient.push(avis);
            localStorage.setItem(`avis_${clientId}`, JSON.stringify(avisClient));
            document.getElementById('avisForm').reset();
            loadAvis();
        }

        function loadAvis() {
            const avisClient = JSON.parse(localStorage.getItem(`avis_${clientId}`)) || [];
            const avisList = document.getElementById('avisList');
            avisList.innerHTML = '';
            avisClient.sort((a, b) => new Date(b.date) - new Date(a.date));
            avisClient.forEach(avis => {
                const avisElement = document.createElement('div');
                avisElement.className = 'avis-item';
                avisElement.innerHTML = `
                    <h3>Intervention du ${new Date(avis.date).toLocaleDateString()}</h3>
                    <p>Heure : ${avis.heureDebut} - ${avis.heureFin}</p>
                    <p>Observations : ${avis.observations}</p>
                    <p>Intervenant : ${avis.intervenant}</p>
                    <p>${avis.typeIntervention === 'prochaine' ? 'Prochaine intervention prévue' : 'Intervention à prévoir'} : 
                       ${avis.dateIntervention ? new Date(avis.dateIntervention).toLocaleString() : 'Date à déterminer'}</p>
                `;
                avisList.appendChild(avisElement);
            });
        }

        document.getElementById('avisForm').addEventListener('submit', saveAvis);
        document.getElementById('typeIntervention').addEventListener('change', function() {
            const dateInterventionField = document.getElementById('dateIntervention');
            dateInterventionField.style.display = this.value === 'aPrevoir' ? 'none' : 'block';
            dateInterventionField.required = this.value !== 'aPrevoir';
        });

        loadClientInfo();
        loadAvis();
    </script>
</body>
</html>
