<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avis de Passage - Nett'Ovation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .section {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
        }
        .avis {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
        }
        .prochaine-intervention {
            background-color: #e6f7ff;
            border: 1px solid #91d5ff;
        }
        .a-prevoir {
            background-color: #fff7e6;
            border: 1px solid #ffd591;
        }
        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>Avis de Passage - <span id="clientName"></span></h1>
    
    <div class="section">
        <h2>Ajouter un avis de passage</h2>
        <form id="avisForm">
            <input type="date" id="date" required>
            <input type="time" id="heureDebut" required>
            <input type="time" id="heureFin" required>
            <textarea id="observations" placeholder="Observations" required></textarea>
            <input type="text" id="intervenant" placeholder="Nom de l'intervenant" required>
            <select id="typeIntervention" required>
                <option value="">Choisir le type d'intervention</option>
                <option value="prochaine">Prochaine intervention</option>
                <option value="aPrevoir">À prévoir</option>
            </select>
            <input type="datetime-local" id="dateIntervention" required>
            <button type="submit">Ajouter l'avis</button>
        </form>
    </div>

    <div class="section">
        <h2>Historique des avis</h2>
        <div id="avisList"></div>
    </div>

    <div class="footer">
        <p>Nett'Ovation - Le nettoyage à la hauteur de vos attentes !</p>
        <p>Contact : <a href="mailto:info@nett-ovation.fr">info@nett-ovation.fr</a> | Tél : 07 82 03 05 02</p>
    </div>

    <script>
        function getClientName() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('client') || 'Client inconnu';
        }

        function loadAvis() {
            const clientName = getClientName();
            let avis = JSON.parse(localStorage.getItem(`avis_${clientName}`)) || [];
            const avisList = document.getElementById('avisList');
            avisList.innerHTML = '';

            // Trier les avis par date, du plus récent au plus ancien
            avis.sort((a, b) => new Date(b.date) - new Date(a.date));

            const now = new Date();
            let prochaineIntervention = null;
            let interventionsAPrevoir = [];

            avis.forEach(a => {
                const avisElement = document.createElement('div');
                avisElement.className = 'avis';

                const dateIntervention = new Date(a.date);
                const dateProchaineIntervention = new Date(a.dateIntervention);

                if (a.typeIntervention === 'prochaine' && dateProchaineIntervention > now && (!prochaineIntervention || dateProchaineIntervention < prochaineIntervention)) {
                    prochaineIntervention = dateProchaineIntervention;
                } else if (a.typeIntervention === 'aPrevoir') {
                    interventionsAPrevoir.push(a);
                }

                avisElement.innerHTML = `
                    <h3>Intervention du ${dateIntervention.toLocaleDateString()}</h3>
                    <p>Heure de début : ${a.heureDebut}</p>
                    <p>Heure de fin : ${a.heureFin}</p>
                    <p>Observations : ${a.observations}</p>
                    <p>Intervenant : ${a.intervenant}</p>
                    <p>${a.typeIntervention === 'prochaine' ? 'Prochaine intervention prévue' : 'Intervention à prévoir'} : ${dateProchaineIntervention.toLocaleString()}</p>
                `;
                avisList.appendChild(avisElement);
            });

            // Afficher la prochaine intervention en haut de la liste
            if (prochaineIntervention) {
                const prochaineInterventionElement = document.createElement('div');
                prochaineInterventionElement.className = 'avis prochaine-intervention';
                prochaineInterventionElement.innerHTML = `
                    <h3>Prochaine intervention prévue</h3>
                    <p>Date et heure : ${prochaineIntervention.toLocaleString()}</p>
                `;
                avisList.insertBefore(prochaineInterventionElement, avisList.firstChild);
            }

            // Afficher les interventions à prévoir
            interventionsAPrevoir.forEach(a => {
                const aPrevoirElement = document.createElement('div');
                aPrevoirElement.className = 'avis a-prevoir';
                aPrevoirElement.innerHTML = `
                    <h3>Intervention à prévoir</h3>
                    <p>Date et heure : ${new Date(a.dateIntervention).toLocaleString()}</p>
                    <p>Observations : ${a.observations}</p>
                `;
                avisList.insertBefore(aPrevoirElement, avisList.firstChild);
            });
        }

        document.getElementById('avisForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const clientName = getClientName();
            const avisData = {
                date: document.getElementById('date').value,
                heureDebut: document.getElementById('heureDebut').value,
                heureFin: document.getElementById('heureFin').value,
                observations: document.getElementById('observations').value,
                intervenant: document.getElementById('intervenant').value,
                typeIntervention: document.getElementById('typeIntervention').value,
                dateIntervention: document.getElementById('dateIntervention').value
            };

            const avis = JSON.parse(localStorage.getItem(`avis_${clientName}`)) || [];
            avis.push(avisData);
            localStorage.setItem(`avis_${clientName}`, JSON.stringify(avis));

            loadAvis();
            document.getElementById('avisForm').reset();
            alert('Avis de passage ajouté avec succès.');
        });

        const clientName = getClientName();
        document.getElementById('clientName').textContent = clientName;
        loadAvis();
    </script>
</body>
</html>
